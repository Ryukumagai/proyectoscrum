<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Homework</title>
  <style>
    :root {
      --azul-oscuro: #0a2342;
      --azul-medio: #185adb;
      --azul-claro: #f3f8ff;
      --blanco: #fff;
      --sombra: 0 4px 16px rgba(24,90,219,0.12);
      --gris: #e5e9f2;
      --verde: #3ec300;
      --rojo: #e74c3c;
    }
    body {
      min-height: 100vh;
      margin: 0;
      background: linear-gradient(135deg, var(--azul-claro) 0%, var(--azul-medio) 100%);
      font-family: 'Segoe UI', 'Arial', sans-serif;
      color: var(--azul-oscuro);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .container {
      background: var(--blanco);
      border-radius: 24px;
      box-shadow: 0 8px 32px rgba(10,35,66,0.18);
      padding: 2rem 1.2rem 1.5rem 1.2rem;
      max-width: 420px;
      width: 95vw;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: box-shadow 0.2s;
      gap: 1.2rem;
    }
    h1 {
      margin-top: 0;
      font-size: 2.2rem;
      color: var(--azul-medio);
      font-weight: 700;
      letter-spacing: 1px;
    }
    .welcome {
      font-size: 1.1rem;
      margin-bottom: 2rem;
      color: var(--azul-oscuro);
      text-align: center;
    }
    input[type="text"], input[type="date"] {
      width: 100%;
      display: block;
      box-sizing: border-box;
      padding: 0.8rem 1rem;
      border: 1.5px solid var(--azul-medio);
      border-radius: 10px;
      font-size: 1rem;
      margin-bottom: 1.2rem;
      outline: none;
      background: var(--azul-claro);
      color: var(--azul-oscuro);
      transition: border 0.2s;
    }
    #userName {
      display: block;
      width: 100%;
      box-sizing: border-box;
    }
    #startBtn {
      width: 100%;
      padding: 0.9rem 0;
      background: var(--azul-medio);
      color: var(--blanco);
      border: none;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: var(--sombra);
      transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
      margin-bottom: 0.5rem;
      text-align: center;
    }
    input[type="text"]:focus, input[type="date"]:focus {
      border: 2px solid var(--azul-oscuro);
    }
    button {
      width: 100%;
      padding: 0.9rem 0;
      background: var(--azul-medio);
      color: var(--blanco);
      border: none;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: var(--sombra);
      transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
      margin-bottom: 0.5rem;
      text-align: center;
    }
    button:hover {
      background: var(--azul-oscuro);
      box-shadow: 0 8px 32px rgba(24,90,219,0.22);
      transform: translateY(-2px) scale(1.03);
    }
    .greeting {
      font-size: 1.3rem;
      color: var(--azul-oscuro);
      margin-top: 1.5rem;
      text-align: center;
      font-weight: 500;
    }
    .task-section {
      width: 100%;
      margin-top: 0.7rem;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 0.7rem;
    }
    .task-form {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 0.7rem;
    }
    .task-list {
      width: 100%;
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .task-item {
      background: var(--azul-claro);
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(24,90,219,0.08);
      padding: 0.7rem 0.8rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: box-shadow 0.2s;
      gap: 0.7rem;
      align-items: flex-start;
    }
    .task-item.completed {
      background: #e6f9e6;
      text-decoration: line-through;
      color: #6c8a6b;
    }
    .task-info {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
      flex: 1 1 0%;
      min-width: 0;
      max-width: 100%;
      overflow: visible;
    }
    .task-title {
      font-size: 1rem;
      font-weight: 500;
      /* Mostrar todo el texto, permitiendo saltos de línea y ajuste */
      white-space: pre-line;
      overflow-wrap: break-word;
      word-break: break-word;
      width: 100%;
      background: transparent;
      border: none;
      padding: 0;
      margin-bottom: 0.2rem;
      /* Eliminar el corte con puntos suspensivos */
      text-overflow: unset;
    }
    .task-date {
      font-size: 0.9rem;
      color: #4a5a7a;
    }
    .task-actions {
      display: flex;
      gap: 0.5rem;
      margin-left: 0.7rem;
    }
    .task-actions button {
      width: auto;
      padding: 0.4rem 0.7rem;
      font-size: 0.95rem;
      border-radius: 7px;
      margin-bottom: 0;
      box-shadow: none;
    }
    .complete-btn {
      background: var(--verde);
      color: var(--blanco);
    }
    .complete-btn:hover {
      background: #2a8a00;
    }
    .delete-btn {
      background: var(--rojo);
      color: var(--blanco);
    }
    .delete-btn:hover {
      background: #b93222;
    }
    /* Extra: CSS para status-btn */
    .status-btn {
      transition: background 0.2s, color 0.2s, opacity 0.2s;
      outline: none;
    }
    .status-btn:focus {
      outline: 2px solid #185adb;
    }
    /* Extra: CSS para priority-select */
    .priority-select {
      margin-top: 0.2rem;
      border-radius: 7px;
      border: 1.5px solid #185adb;
      padding: 0.4rem 0.7rem;
      font-size: 0.95rem;
      color: #0a2342;
      background: #e5e9f2;
      font-weight: 600;
      outline: none;
      transition: border 0.2s;
    }
    .priority-select:focus {
      border: 2px solid #185adb;
    }
    /* Estilo para el select de categoría igual a los botones */
    #taskCategory {
      width: 100%;
      padding: 0.9rem 0;
      background: var(--azul-medio);
      color: var(--blanco);
      border: none;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: var(--sombra);
      transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
      margin-bottom: 0.5rem;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      text-align: center;
    }
    #taskCategory:hover {
      background: var(--azul-oscuro);
      box-shadow: 0 8px 32px rgba(24,90,219,0.22);
      transform: translateY(-2px) scale(1.03);
    }
    #taskCategory:focus {
      outline: 2px solid var(--azul-oscuro);
    }
    /* Colores personalizados para las opciones */
    #taskCategory option[value="home"] {
      background: #b9fbc0;
      color: #0a2342;
    }
    #taskCategory option[value="work"] {
      background: #ffe5b4;
      color: #0a2342;
    }
    #taskCategory option[value="other"] {
      background: #ffb3b3;
      color: #0a2342;
    }
    /* Logo grande y centrado dentro del contenedor principal, tamaño original y responsivo */
    .brand-logo {
      position: static !important;
      display: block;
      margin: 0 auto 0 auto;
      width: max-content;
      height: max-content;
      max-width: 80vw;
      min-width: 80px;
      object-fit: contain;
      z-index: 2;
      pointer-events: none;
      user-select: none;
      filter: drop-shadow(0 8px 32px rgba(10,35,66,0.18));
      transition: width 0.2s;
    }
    @media (max-width: 600px) {
      .brand-logo {
        width: 180px;
        min-width: 80px;
      }
    }
  </style>
</head>
<body>
  <div class="container" id="mainContainer">
    <!-- Logo grande y centrado en el lugar del título principal -->
    <img src="logcasa.png" alt="Logo My Homework" class="brand-logo" id="mainLogo" style="position:static;display:block;margin:0 auto 1.5rem auto;width:320px;max-width:80vw;z-index:2;pointer-events:none;user-select:none;filter:drop-shadow(0 8px 32px rgba(10,35,66,0.18));" />
    <div id="registerSection">
      <div class="welcome">¡Bienvenido! Ingresa tu nombre para comenzar a organizar tus tareas.</div>
      <input type="text" id="userName" placeholder="Tu nombre..." autocomplete="off" />
      <button id="startBtn">Vamos a agregar tus tareas</button>
    </div>
    <div id="taskSection" style="display:none; width:100%;">
      <div class="greeting" id="greetingMsg"></div>
      <div class="task-section">
        <form class="task-form" id="taskForm">
          <input type="text" id="taskInput" placeholder="Nueva tarea..." required autocomplete="off" />
          <input type="date" id="taskDate" required />
          <select id="taskCategory" required style="margin-bottom:1.2rem;">
            <option value="home">Home Tasks</option>
            <option value="work">Work Tasks</option>
            <option value="other">Other Tasks</option>
          </select>
          <button type="submit">Agregar tarea</button>
          <button type="button" id="calendarBtn">Calendario</button>
          <div class="excel-dropdown-container" style="position:relative;width:100%;">
            <button type="button" id="downloadExcelBtn" style="margin-bottom:0.7rem;background:#21b573;position:relative;z-index:2;">Descargar Excel ▼</button>
            <ul id="excelDropdown" style="display:none;position:absolute;top:100%;left:0;width:100%;background:#fff;border-radius:10px;box-shadow:0 4px 16px rgba(24,90,219,0.12);padding:0.3rem 0;margin:0;list-style:none;z-index:10;">
              <li><button type="button" class="excel-option" data-type="all" style="width:100%;background:none;color:#0a2342;padding:0.7rem 0;text-align:left;border:none;font-size:1rem;cursor:pointer;">Descargar todo</button></li>
              <li><button type="button" class="excel-option" data-type="home" style="width:100%;background:#b9fbc0;color:#0a2342;padding:0.7rem 0;text-align:left;border:none;font-size:1rem;cursor:pointer;">Descargar Home</button></li>
              <li><button type="button" class="excel-option" data-type="work" style="width:100%;background:#ffe5b4;color:#0a2342;padding:0.7rem 0;text-align:left;border:none;font-size:1rem;cursor:pointer;">Descargar Work</button></li>
              <li><button type="button" class="excel-option" data-type="other" style="width:100%;background:#ffb3b3;color:#0a2342;padding:0.7rem 0;text-align:left;border:none;font-size:1rem;cursor:pointer;">Descargar Other</button></li>
            </ul>
          </div>
        </form>
        <div class="task-lists-container" style="display:flex;gap:1.2rem;flex-wrap:wrap;justify-content:center;width:100%;">
          <div class="task-list-section" style="flex:1 1 0;min-width:220px;max-width:100%;">
            <h3 style="text-align:center;color:#185adb;margin-bottom:0.5rem;">Home Tasks</h3>
            <ul class="task-list" id="homeTaskList"></ul>
            <button type="button" id="downloadHomeBtn" style="background:#b9fbc0;color:#0a2342;margin-top:0.5rem;">Descargar Home</button>
          </div>
          <div class="task-list-section" style="flex:1 1 0;min-width:220px;max-width:100%;">
            <h3 style="text-align:center;color:#185adb;margin-bottom:0.5rem;">Work Tasks</h3>
            <ul class="task-list" id="workTaskList"></ul>
            <button type="button" id="downloadWorkBtn" style="background:#ffe5b4;color:#0a2342;margin-top:0.5rem;">Descargar Work</button>
          </div>
          <div class="task-list-section" style="flex:1 1 0;min-width:220px;max-width:100%;">
            <h3 style="text-align:center;color:#185adb;margin-bottom:0.5rem;">Other Tasks</h3>
            <ul class="task-list" id="otherTaskList"></ul>
            <button type="button" id="downloadOtherBtn" style="background:#ffb3b3;color:#0a2342;margin-top:0.5rem;">Descargar Other</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal calendario -->
  <div id="calendarModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(10,35,66,0.45);z-index:1000;align-items:center;justify-content:center;">
    <div style="background:#fff;color:#0a2342;border-radius:18px;max-width:1200px;width:90vw;min-width:320px;padding:2.5rem 2rem;box-shadow:0 8px 32px rgba(10,35,66,0.18);position:relative;max-height:85vh;overflow:auto;display:flex;flex-direction:column;justify-content:flex-start;align-items:center;">
      <button id="closeCalendar" style="position:absolute;top:0;right:0;width:44px;height:44px;background:none;border:none;font-size:2rem;color:#185adb;cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:10;">&times;</button>
      <h2 style="margin-top:0;text-align:center;color:#185adb;">Calendario de Tareas</h2>
      <div id="calendarContent" style="display:grid;grid-template-columns:repeat(3,1fr);gap:1.5rem;width:100%;"></div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script>
    // Registro y saludo
    const startBtn = document.getElementById('startBtn');
    const userNameInput = document.getElementById('userName');
    const registerSection = document.getElementById('registerSection');
    const taskSection = document.getElementById('taskSection');
    const greetingMsg = document.getElementById('greetingMsg');

    let userName = '';
    let tasks = [];

    startBtn.addEventListener('click', () => {
      const name = userNameInput.value.trim();
      if (name.length === 0) {
        userNameInput.focus();
        userNameInput.style.border = "2px solid #e74c3c";
        return;
      }
      userName = name;
      registerSection.style.display = "none";
      taskSection.style.display = "block";
      greetingMsg.textContent = `¡Hola, ${name}! Aquí puedes gestionar tus tareas.`;
      // Ocultar logo al pasar a la vista de tareas
      document.getElementById('mainLogo').style.display = 'none';
      loadTasks();
      renderTasks();
    });

    userNameInput.addEventListener('input', () => {
      userNameInput.style.border = "1.5px solid var(--azul-medio)";
    });

    // Gestión de tareas
    const taskForm = document.getElementById('taskForm');
    const taskInput = document.getElementById('taskInput');
    const taskDate = document.getElementById('taskDate');
    const taskCategory = document.getElementById('taskCategory');
    const homeTaskList = document.getElementById('homeTaskList');
    const workTaskList = document.getElementById('workTaskList');
    const otherTaskList = document.getElementById('otherTaskList');

    // Establecer fecha actual como valor inicial en el input de fecha
    function setTodayAsDefaultDate() {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');
      taskDate.value = `${yyyy}-${mm}-${dd}`;
    }
    setTodayAsDefaultDate();

    function saveTasks() {
      if (userName) {
        localStorage.setItem('tasks_' + userName, JSON.stringify(tasks));
      }
    }
    function loadTasks() {
      if (userName) {
        const saved = localStorage.getItem('tasks_' + userName);
        tasks = saved ? JSON.parse(saved) : [];
      }
    }
    function renderTasks() {
      homeTaskList.innerHTML = '';
      workTaskList.innerHTML = '';
      otherTaskList.innerHTML = '';
      if (tasks.length === 0) {
        homeTaskList.innerHTML = '<li style="text-align:center;color:#888;">No Home tasks yet.</li>';
        workTaskList.innerHTML = '<li style="text-align:center;color:#888;">No Work tasks yet.</li>';
        otherTaskList.innerHTML = '<li style="text-align:center;color:#888;">No Other tasks yet.</li>';
        return;
      }
      tasks.forEach((task, idx) => {
        const li = document.createElement('li');
        li.className = 'task-item' + (task.status === 'Completada' ? ' completed' : '');
        const info = document.createElement('div');
        info.className = 'task-info';
        // Título editable
        let title;
        if (task.editing) {
          title = document.createElement('input');
          title.type = 'text';
          title.className = 'task-title';
          title.value = task.text;
          title.addEventListener('change', () => {
            tasks[idx].text = title.value;
            saveTasks();
          });
        } else {
          title = document.createElement('div');
          title.className = 'task-title';
          // Permitir saltos de línea si el usuario los pone
          title.textContent = task.text;
          title.style.whiteSpace = 'pre-line';
          title.style.overflowWrap = 'break-word';
          title.style.wordBreak = 'break-word';
        }
        // Fecha editable
        const date = document.createElement('input');
        date.type = 'date';
        date.className = 'task-date';
        date.value = task.date;
        date.readOnly = !task.editing;
        date.style.background = task.editing ? '#fff' : 'transparent';
        date.style.border = task.editing ? '1px solid #185adb' : 'none';
        date.style.color = '#4a5a7a';
        date.style.fontSize = '0.9rem';
        // Botón de estado
        const statusBtn = document.createElement('button');
        statusBtn.type = 'button';
        statusBtn.className = 'status-btn';
        statusBtn.textContent = (task.status === 'Completada') ? 'Completada' : 'En curso';
        statusBtn.style.background = (task.status === 'Completada') ? '#3ec300' : '#ffd600';
        statusBtn.style.color = (task.status === 'Completada') ? '#fff' : '#0a2342';
        statusBtn.style.fontWeight = 'bold';
        statusBtn.style.border = 'none';
        statusBtn.style.borderRadius = '7px';
        statusBtn.style.padding = '0.4rem 0.7rem';
        statusBtn.style.marginBottom = '0.2rem';
        statusBtn.style.cursor = 'pointer';
        statusBtn.style.boxShadow = '0 2px 8px rgba(24,90,219,0.08)';
        statusBtn.onmouseover = function() { statusBtn.style.opacity = '0.85'; };
        statusBtn.onmouseout = function() { statusBtn.style.opacity = '1'; };
        statusBtn.onclick = () => {
          tasks[idx].status = (task.status === 'En curso') ? 'Completada' : 'En curso';
          saveTasks();
          renderTasks();
        };
        // Prioridad
        const priority = document.createElement('select');
        priority.className = 'priority-select';
        const priorityColors = {
          'Baja': {bg: '#b9fbc0', color: '#0a2342'}, // verde pastel
          'Media': {bg: '#ffe5b4', color: '#0a2342'}, // naranja pastel
          'Alta': {bg: '#ffb3b3', color: '#0a2342'}, // rojo pastel
          'Urgente': {bg: '#222', color: '#fff'} // negro con blanco
        };
        ['Baja', 'Media', 'Alta', 'Urgente'].forEach(opt => {
          const option = document.createElement('option');
          option.value = opt;
          option.textContent = 'Prioridad: ' + opt;
          if ((task.priority || 'Media') === opt) option.selected = true;
          option.style.background = priorityColors[opt].bg;
          option.style.color = priorityColors[opt].color;
          priority.appendChild(option);
        });
        // Aplica color al select según valor
        function setPriorityColor() {
          const val = priority.value;
          priority.style.background = priorityColors[val].bg;
          priority.style.color = priorityColors[val].color;
        }
        setPriorityColor();
        priority.disabled = !task.editing;
        priority.addEventListener('change', () => {
          tasks[idx].priority = priority.value;
          saveTasks();
          setPriorityColor();
        });
        // Guardar cambios al salir de edición
        date.addEventListener('change', () => {
          tasks[idx].date = date.value;
          saveTasks();
        });
        info.appendChild(title);
        info.appendChild(date);
        info.appendChild(statusBtn);
        info.appendChild(priority);
        li.appendChild(info);
        const actions = document.createElement('div');
        actions.className = 'task-actions';
        // Botón editar/guardar
        const editBtn = document.createElement('button');
        editBtn.className = 'edit-btn';
        editBtn.textContent = task.editing ? 'Guardar' : 'Editar';
        editBtn.onclick = () => {
          if (task.editing) {
            tasks[idx].editing = false;
            tasks[idx].text = title.value;
            tasks[idx].date = date.value;
            tasks[idx].priority = priority.value;
            saveTasks();
          } else {
            tasks.forEach(t => t.editing = false);
            tasks[idx].editing = true;
          }
          renderTasks();
        };
        // Botón eliminar
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.textContent = 'Eliminar';
        deleteBtn.onclick = () => {
          tasks.splice(idx, 1);
          saveTasks();
          renderTasks();
        };
        actions.appendChild(editBtn);
        actions.appendChild(deleteBtn);
        li.appendChild(actions);
        // Añadir a la lista correspondiente
        if ((task.category || 'home') === 'home') homeTaskList.appendChild(li);
        else if (task.category === 'work') workTaskList.appendChild(li);
        else otherTaskList.appendChild(li);
      });
      if (!homeTaskList.children.length) homeTaskList.innerHTML = '<li style="text-align:center;color:#888;">No Home tasks yet.</li>';
      if (!workTaskList.children.length) workTaskList.innerHTML = '<li style="text-align:center;color:#888;">No Work tasks yet.</li>';
      if (!otherTaskList.children.length) otherTaskList.innerHTML = '<li style="text-align:center;color:#888;">No Other tasks yet.</li>';
    }
    taskForm.addEventListener('submit', e => {
      e.preventDefault();
      const text = taskInput.value.trim();
      const date = taskDate.value;
      const category = taskCategory.value;
      if (!text || !date || !category) return;
      tasks.push({ text, date, status: 'En curso', editing: false, priority: 'Media', category });
      saveTasks();
      renderTasks();
      taskInput.value = '';
      setTodayAsDefaultDate();
      taskCategory.value = 'home';
      taskInput.focus();
    });
    // Calendario
    const calendarBtn = document.getElementById('calendarBtn');
    const calendarModal = document.getElementById('calendarModal');
    const closeCalendar = document.getElementById('closeCalendar');
    const calendarContent = document.getElementById('calendarContent');

    calendarBtn.addEventListener('click', () => {
      renderCalendar();
      calendarModal.style.display = 'flex';
    });
    closeCalendar.addEventListener('click', () => {
      calendarModal.style.display = 'none';
    });
    window.addEventListener('click', (e) => {
      if (e.target === calendarModal) calendarModal.style.display = 'none';
    });

    function renderCalendar() {
      if (!tasks.length) {
        calendarContent.innerHTML = '<div style="text-align:center;color:#888;grid-column:1/4;">No tienes tareas aún.</div>';
        calendarContent.style.display = 'block';
        return;
      }
      calendarContent.style.display = 'grid';
      calendarContent.style.gridTemplateColumns = 'repeat(3, 1fr)';
      calendarContent.style.gap = '1.5rem';
      // Separar tareas por categoría
      const categories = {
        home: [],
        work: [],
        other: []
      };
      tasks.forEach(task => {
        const cat = task.category || 'home';
        categories[cat].push(task);
      });
      const categoryLabels = {
        home: 'Home',
        work: 'Work',
        other: 'Other'
      };
      const categoryColors = {
        home: '#b9fbc0',
        work: '#ffe5b4',
        other: '#ffb3b3'
      };
      calendarContent.innerHTML = ['home','work','other'].map(cat =>
        `<div style="display:flex;flex-direction:column;gap:1rem;min-width:0;">
          <h3 style="text-align:center;color:#185adb;margin:0 0 0.7rem 0;">${categoryLabels[cat]}</h3>
          ${categories[cat].length === 0 ? `<div style='text-align:center;color:#aaa;'>Sin tareas</div>` :
            categories[cat].map(task => `
              <div style="background:${task.status==='Completada'?'#e6f9e6':'#f3f8ff'};border-radius:10px;padding:0.8rem 1rem;box-shadow:0 2px 8px rgba(24,90,219,0.08);">
                <div style="font-weight:600;font-size:1.08rem;white-space:pre-line;word-break:break-word;">${task.text}</div>
                <div style="font-size:0.97rem;color:#4a5a7a;">Fecha: ${task.date}</div>
                <div style="font-size:0.97rem;">Lista: <span style="font-weight:600;background:${categoryColors[cat]};color:#0a2342;padding:2px 8px;border-radius:6px;">${categoryLabels[cat]}</span></div>
                <div style="font-size:0.97rem;">Estado: <span style="font-weight:600;color:${task.status==='Completada'?'#3ec300':'#ffd600'}">${task.status}</span></div>
                <div style="font-size:0.97rem;">Prioridad: <span style="font-weight:600;${task.priority==='Baja'?'color:#0a2342;background:#b9fbc0;padding:2px 8px;border-radius:6px;':task.priority==='Media'?'color:#0a2342;background:#ffe5b4;padding:2px 8px;border-radius:6px;':task.priority==='Alta'?'color:#0a2342;background:#ffb3b3;padding:2px 8px;border-radius:6px;':'color:#fff;background:#222;padding:2px 8px;border-radius:6px;'}">${task.priority||'Media'}</span></div>
              </div>
            `).join('')
          }
        </div>`
      ).join('');
    }
    // --- Excel Dropdown ---
    const downloadExcelBtn = document.getElementById('downloadExcelBtn');
    const excelDropdown = document.getElementById('excelDropdown');
    let dropdownTimeout = null;
    // Mostrar/ocultar menú al hacer click
    downloadExcelBtn.addEventListener('click', (e) => {
      if (excelDropdown.style.display === 'block') {
        excelDropdown.style.display = 'none';
      } else {
        excelDropdown.style.display = 'block';
      }
    });
    // Ocultar menú si se hace click fuera
    document.addEventListener('click', (e) => {
      if (!downloadExcelBtn.contains(e.target) && !excelDropdown.contains(e.target)) {
        excelDropdown.style.display = 'none';
      }
    });
    // Doble click para descargar todo
    downloadExcelBtn.addEventListener('dblclick', () => {
      descargarExcel('all');
      excelDropdown.style.display = 'none';
    });
    // Opciones del menú
    document.querySelectorAll('.excel-option').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const type = btn.getAttribute('data-type');
        descargarExcel(type);
        excelDropdown.style.display = 'none';
      });
    });
    // Función para descargar Excel según tipo
    function descargarExcel(type) {
      if (type === 'all') {
        // Descargar todas las tareas (3 hojas)
        const categories = { home: [], work: [], other: [] };
        tasks.forEach(t => {
          const cat = t.category || 'home';
          categories[cat].push({
            Tarea: t.text,
            Fecha: t.date,
            Estado: t.status,
            Prioridad: t.priority,
          });
        });
        const wb = XLSX.utils.book_new();
        Object.entries(categories).forEach(([cat, arr]) => {
          const ws = XLSX.utils.json_to_sheet(arr.length ? arr : [{Tarea:'',Fecha:'',Estado:'',Prioridad:''}]);
          XLSX.utils.book_append_sheet(wb, ws, cat.charAt(0).toUpperCase() + cat.slice(1));
        });
        XLSX.writeFile(wb, 'tareas.xlsx');
      } else if (type === 'home' || type === 'work' || type === 'other') {
        const filtered = tasks.filter(t => (t.category || 'home') === type).map(t => ({
          Tarea: t.text,
          Fecha: t.date,
          Estado: t.status,
          Prioridad: t.priority,
        }));
        const ws = XLSX.utils.json_to_sheet(filtered.length ? filtered : [{Tarea:'',Fecha:'',Estado:'',Prioridad:''}]);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, type.charAt(0).toUpperCase() + type.slice(1));
        XLSX.writeFile(wb, `${type}_tasks.xlsx`);
      }
    }
  </script>
</body>
</html>

   
